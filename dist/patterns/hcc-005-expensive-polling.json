{
  "id": "hcc-005-expensive-polling",
  "version": "1.0.0",
  "enabled": true,
  "category": "performance",
  "severity": "HIGH",
  "title": "Expensive WP functions in polling intervals (HCC-005)",
  "description": "Detects expensive WordPress functions (get_plugins, get_themes, WP_Query, etc.) called within setInterval polling loops, which can cause severe performance degradation.",
  "rationale": "Calling expensive WordPress functions repeatedly in polling intervals can cause database overload, memory exhaustion, and slow page loads. These functions should be cached or called on-demand, not in tight polling loops.",
  "detection": {
    "type": "scripted",
    "file_patterns": ["*.js", "*.php"],
    "search_pattern": "setInterval[[:space:]]*\\(",
    "validator_script": "validators/context-pattern-check.sh",
    "validator_args": ["get_plugins\\(|get_themes\\(|get_posts\\(|WP_Query|get_users\\(|wp_get_recent_posts\\(|get_categories\\(|get_terms\\(", "20", "after"]
  },
  "remediation": {
    "summary": "Cache expensive function results, use transients, or implement on-demand loading instead of polling.",
    "examples": [
      {
        "bad": "setInterval(() => {\n  const posts = wp.apiFetch({ path: '/wp/v2/posts' });\n}, 5000);",
        "good": "// Use transients for caching\nfunction getCachedPosts() {\n  const cached = get_transient('my_posts_cache');\n  if (cached) return cached;\n  const posts = get_posts();\n  set_transient('my_posts_cache', posts, 300); // 5 min cache\n  return posts;\n}",
        "note": "Cache expensive queries with transients."
      }
    ],
    "references": [
      "https://developer.wordpress.org/reference/functions/set_transient/"
    ]
  },
  "metadata": {
    "tags": ["performance", "wordpress", "polling", "caching", "database"],
    "added_in_version": "1.0.0",
    "last_updated": "1.3.16"
  }
}

