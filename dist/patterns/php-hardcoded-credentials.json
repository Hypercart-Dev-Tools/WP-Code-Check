{
  "id": "php-hardcoded-credentials",
  "version": "1.0.0",
  "added_in_scanner_version": "1.3.9",
  "enabled": true,
  "detection_type": "direct",
  "category": "security",
  "severity": "CRITICAL",
  "title": "Hardcoded credentials in PHP",
  "description": "Detects API keys, secrets, tokens, or passwords hardcoded into PHP source files.",
  "rationale": "Credentials committed to source control leak via repositories, error messages, logs, and backups. They are hard to rotate and often reused across environments, creating long-lived attack surface.",
  "detection": {
    "type": "grep",
    "file_patterns": ["*.php"],
    "patterns": [
      {
        "id": "cred-variable-assignment-lower",
        "pattern": "\\$[A-Za-z0-9_]*(password|passwd|secret|token|api_key|apikey|auth_token)[A-Za-z0-9_]*[[:space:]]*=[[:space:]]*['\"][^'\"]{8,}['\"]",
        "description": "Suspicious variable name containing credential keyword assigned to a long string literal"
      },
      {
        "id": "cred-variable-assignment-upper",
        "pattern": "\\$[A-Z0-9_]*(PASSWORD|PASSWD|SECRET|TOKEN|API_KEY|AUTH_TOKEN)[A-Z0-9_]*[[:space:]]*=[[:space:]]*['\"][^'\"]{8,}['\"]",
        "description": "Uppercase credential-style variable assigned to a long string literal"
      },
      {
        "id": "cred-constant-define",
        "pattern": "define[[:space:]]*\\([[:space:]]*['\"][A-Z0-9_]*(SECRET|TOKEN|PASSWORD|KEY|API)[A-Z0-9_]*['\"][[:space:]]*,[[:space:]]*['\"][^'\"]{8,}['\"]",
        "description": "define() of a constant whose name contains SECRET/TOKEN/PASSWORD/KEY/API with a long string literal value"
      },
      {
        "id": "cred-authorization-header-bearer",
        "pattern": "\"Authorization\"[[:space:]]*=>[[:space:]]*\"Bearer[[:space:]]+[A-Za-z0-9._-]{16,}\"",
        "description": "Authorization => 'Bearer <long token>' header defined inline"
      }
    ],
    "exclude_patterns": [
      "//.*(API_KEY|SECRET|TOKEN|PASSWORD|PRIVATE_KEY)",
      "/\\*.*(API_KEY|SECRET|TOKEN|PASSWORD|PRIVATE_KEY).*\\*/",
      "PUBLIC_KEY",
      "PUBLISHABLE_KEY"
    ],
    "exclude_files": [
      "*/vendor/*",
      "*/node_modules/*"
    ]
  },
  "test_fixture": {
    "path": "dist/tests/fixtures/php-hardcoded-credentials.php",
    "expected_violations": 4,
    "notes": "Fixture contains representative variable assignments, constants, and Authorization headers with hardcoded secrets."
  },
  "remediation": {
    "summary": "Move all credentials into environment variables or WordPress configuration that is not committed to version control.",
    "examples": [
      {
        "bad": "$api_key = 'sk_live_abc123def456ghi789';",
        "good": "$api_key = getenv('MY_PLUGIN_API_KEY');",
        "note": "Use environment variables or wp-config.php, not literals in plugin code."
      },
      {
        "bad": "define('API_SECRET_KEY', 'super-secret-value-xyz-123');",
        "good": "define('API_SECRET_KEY', getenv('MY_PLUGIN_API_SECRET_KEY'));",
        "note": "Avoid committing secret constants; inject them from secure configuration."
      }
    ]
  },
  "security_impact": {
    "level": "CRITICAL",
    "cwe": "CWE-798",
    "owasp": "A02:2021 Cryptographic Failures",
    "notes": "Credentials in source control are hard to rotate and tend to leak across environments, leading to long-lived compromise."
  }
}

