{
  "id": "php-dynamic-include",
  "version": "1.0.0",
  "added_in_scanner_version": "1.3.7",
  "enabled": true,
  "detection_type": "direct",
  "category": "security",
  "severity": "CRITICAL",
  "title": "Dynamic PHP include/require with variables",
  "description": "Detects include/require statements where the path expression contains variables. Dynamic includes are a common source of local/remote file inclusion vulnerabilities.",
  "rationale": "Dynamic include/require with variables allows attackers to control which file is executed. When combined with user input (e.g., $_GET, $_POST), this can lead directly to remote code execution by including arbitrary PHP files (uploads, backups, logs).",
  "detection": {
    "type": "grep",
    "file_patterns": ["*.php"],
    "patterns": [
      {
        "id": "include-variable",
        "pattern": "include(_once)?[[:space:]]+[^;]*\\$",
        "description": "include/include_once with variable-based path expression"
      },
      {
        "id": "require-variable",
        "pattern": "require(_once)?[[:space:]]+[^;]*\\$",
        "description": "require/require_once with variable-based path expression"
      }
    ],
    "exclude_patterns": [
      "//.*include",
      "//.*require"
    ],
    "exclude_files": [
      "*/vendor/*",
      "*/node_modules/*",
      "*/tests/*",
      "*/test/*"
    ]
  },
  "test_fixture": {
    "path": "dist/tests/fixtures/eval-and-include-antipatterns.php",
    "expected_violations": 2,
    "notes": "Fixture contains include/require statements whose paths are derived from variables and superglobals."
  },
  "remediation": {
    "summary": "Avoid dynamic include/require with variables. Use explicit whitelists or mapping tables from identifiers to known-safe file paths.",
    "examples": [
      {
        "bad": "include $_GET['page'] . '.php';",
        "good": "$views = ['dashboard' => __DIR__ . '/views/dashboard.php']; $view = $views[$_GET['page']] ?? null; if ($view) { include $view; }",
        "note": "Use a whitelist of allowed templates instead of including arbitrary files."
      },
      {
        "bad": "require $template;",
        "good": "$template = 'settings'; require __DIR__ . '/views/' . $template . '.php';",
        "note": "Only use known template identifiers, not raw user input."
      }
    ]
  },
  "security_impact": {
    "level": "CRITICAL",
    "cwe": "CWE-98",
    "owasp": "A03:2021 Injection",
    "notes": "File inclusion vulnerabilities allow attackers to execute arbitrary PHP code by including uploaded files, backups, or remote URLs. This often results in full site compromise."
  },
  "references": [
    "https://www.php.net/manual/en/function.include.php",
    "https://www.php.net/manual/en/function.require.php",
    "https://cheatsheetseries.owasp.org/cheatsheets/PHP_Configuration_Cheat_Sheet.html#remote-file-inclusion",
    "https://cwe.mitre.org/data/definitions/98.html"
  ]
}

